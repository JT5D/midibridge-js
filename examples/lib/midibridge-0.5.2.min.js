(function(){function j(){return!a.ready?(g&&g("midibridge not ready!"),"midibridge not ready!"):!0}function o(){try{c=a.getObject("midibridge-applet")}catch(b){setTimeout(o,25)}}try{console.log("")}catch(s){console={log:function(){}}}var a={NOTE_OFF:128,NOTE_ON:144,POLY_PRESSURE:160,CONTROL_CHANGE:176,PROGRAM_CHANGE:192,CHANNEL_PRESSURE:208,PITCH_BEND:224,SYSTEM_EXCLUSIVE:240,NOTE_NAMES_SHARP:"sharp",NOTE_NAMES_FLAT:"flat",NOTE_NAMES_SOUNDFONT:"soundfont",NOTE_NAMES_ENHARMONIC_SHARP:"enh-sharp",NOTE_NAMES_ENHARMONIC_FLAT:"enh-flat"},
k=[];k[128]="NOTE OFF";k[144]="NOTE ON";k[160]="POLY PRESSURE";k[176]="CONTROL CHANGE";k[192]="PROGRAM CHANGE";k[208]="CHANNEL PRESSURE";k[224]="PITCH BEND";k[240]="SYSTEM EXCLUSIVE";var m={sharp:"C,C#,D,D#,E,F,F#,G,G#,A,A#,B".split(","),flat:"C,D&#9837;,D,E&#9837;,E,F,G&#9837;,G,A&#9837;,A,B&#9837;,B".split(","),soundfont:"C,Db,D,Eb,E,F,Gb,G,Ab,A,Bb,B".split(","),"enh-sharp":"B#,C#,C##,D#,D##,E#,F#,F##,G#,G##,A#,A##".split(","),"enh-flat":"D&#9837;&#9837;,D&#9837;,E&#9837;&#9837;,E&#9837;,F&#9837;,G&#9837;&#9837;,G&#9837;,A&#9837;&#9837;,A&#9837;,B&#9837;&#9837;,B&#9837;,C&#9837;".split(",")},
e=JSON.parse,l=null,g=null,n=null,c=null,f=!1,h=!1,d=!1,i=!0,p={};a.version="0.5.2";a.ready=!1;a.noteNameModus=a.NOTE_NAMES_SHARP;a.init=function(b){if("function"===typeof b)l=b;else if("object"===typeof b)switch(f=b.connectAllInputs,h=b.connectFirstInput,d=b.connectFirstOutput,i=b.connectAllInputsToFirstOutput,l=b.data,n=b.ready,g=b.error,!0){case i:d=h=f=!1;i=!0;break;case f&&d:d=h=f=!1;i=!0;break;case f:f=!0;i=d=h=!1;break;case d&&h:f=!1;d=h=!0;i=!1;break;case d&&f:d=h=f=!1;i=!0;break;case d:h=
f=!1;d=!0;i=!1;break;case h:f=!1;h=!0;i=d=!1;break;default:i=!0}if(navigator.javaEnabled())try{if(void 0===e)console.log("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+");else{var a=document.createElement("div");a.setAttribute("id","midibridge-java");a.innerHTML='<applet id="midibridge-applet" code="net.abumarkub.midi.applet.MidiApplet.class" archive="midiapplet.jar" codebase="java" width="1" height="1"><param name="minJavaVersion" value="1.5"></applet>';
document.body.appendChild(a)}}catch(c){g?g("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+"):console.log("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+")}else g?g("no java plugin found; install or enable the java plugin"):console.log("no java plugin found; install or enable the java plugin")};a.msgFromJava=function(b){b=e(b);switch(b.msgId){case "upgrade-java":g?g("please upgrade your java plugin!"):
console.log("please upgrade your java plugin!");break;case "midi-started":o();c&&(p=b.devices,a.ready=!0,f&&a.connectAllInputs(),h&&a.connectFirstInput(),d&&a.connectFirstOutput(),i&&a.connectAllInputsToFirstOutput(),n&&n("midibridge started"));break;case "midi-data":if(l){if(void 0===a.getStatus(b.status)){console.log("weird MIDI message intercepted",b.status);break}l(new q(b))}break;case "error":g&&g(b.code)}};a.sendMidiEvent=function(b,a,r,d){return j()?e(c.processMidiEvent(b,a,r,d)):!1};a.getDevices=
function(){return p};a.refreshDevices=function(){return j()?e(c.getDevices()):!1};a.connectAllInputs=function(){return j()?e(c.connectAllInputs()):!1};a.connectFirstInput=function(){return j()?e(c.connectFirstInput()):!1};a.connectFirstOutput=function(){return j()?e(c.connectFirstOutput()):!1};a.connectAllInputsToFirstOutput=function(){return j()?e(c.connectAllInputsToFirstOutput()):!1};a.addConnection=function(b,a,d){return j()?(d=void 0===d?[]:d,e(c.addConnection(b,void 0===a?-1:a,d))):!1};a.removeConnection=
function(b,a){return j()?e(c.removeConnection(b,a)):!1};a.disconnectAll=function(){return j()?e(c.disconnectAll()):!1};a.loadBase64String=function(b){return e(c.loadBase64String(b))};a.playBase64String=function(b){return e(c.playBase64String(b))};a.loadMidiFile=function(b){return e(c.loadMidiFile(b))};a.playMidiFile=function(b){return e(c.playMidiFile(b))};a.startSequencer=function(){c.startSequencer()};a.pauseSequencer=function(){c.pauseSequencer()};a.stopSequencer=function(){c.stopSequencer()};
a.closeSequencer=function(){c.closeSequencer()};a.getSequencerPosition=function(){return c.getSequencerPosition()};a.setSequencerPosition=function(b){c.setSequencerPosition(b)};var q=function(){var b=function(b){this.data1=b.data1;this.data2=b.data2;this.status=b.status;this.status="0"===this.data2&&this.status==a.NOTE_ON?a.NOTE_OFF:this.status;this.channel=b.channel;this.noteName=a.getNoteName(this.data1,a.noteNameModus);this.statusCode=a.getStatus(this.status);this.microsecond=b.microsecond;this.time=
a.getNiceTime(this.microsecond)};b.prototype={toString:function(){var b;b=""+(this.noteName+" "+this.statusCode+" "+this.data1+" "+this.data2+" "+this.status);return b+=this.microsecond?this.microsecond+" "+this.time:""},toJSONString:function(){return this.microsecond?"{'notename':"+this.noteName+", 'status':"+this.status+", 'data1':"+this.data1+", 'data2':"+this.data2+", 'microsecond':"+this.microsecond+", 'time':"+this.time+"}":"{'notename':"+this.noteName+", 'status':"+this.status+", 'data1':"+
this.data1+", 'data2':"+this.data2+"}"}};return b}();a.MidiMessage=q;a.getNoteName=function(b,a){return m[a][b%12]+""+Math.floor(b/12-1)};a.getNoteNumber=function(b,a){var c=-1,b=b.toUpperCase(),d;for(d in m)for(var e=m[d],f=0,g=e.length;f<g;f++)if(e[f]===b){c=f;break}return-1===c?"invalid note name":noteNumber=12+c+12*a};a.getStatus=function(b){return k[b]};a.getNiceTime=function(b){var a=b/1E3/1E3>>0,c=a/3600>>0,d=a%3600/60>>0,a=a%60,b=b/1E3-36E5*c-6E4*d-1E3*a+0.5>>0;return""+(0<c?c+":":"")+(0<
c?10>d?"0"+d:d:d)+":"+(10>a?"0"+a:a)+":"+(0===b?"000":10>b?"00"+b:100>b?"0"+b:b)};a.getObject=function(b){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("msie")||-1!==a.indexOf("webkit")?window[b]:document[b]};window.addEventListener||(window.addEventListener=function(a,c){window.attachEvent("onload",c)});window.midiBridge=a})(window);
(function(){function q(a){var b=navigator.userAgent.toLowerCase();if(b.indexOf("msie")!==-1||b.indexOf("webkit")!==-1){return window[a]}else{return document[a]}}function p(){try{f=q("midibridge-applet")}catch(a){setTimeout(p,25);return}}function l(){var a=document.createElement("div");a.setAttribute("id","midibridge-java");var b="";b+='<object tabindex="0" id="midibridge-applet" type="application/x-java-applet" height="1" width="1">';b+='<param name="codebase" value="'+j+'/" />';b+='<param name="archive" value="midiapplet.jar" />';b+='<param name="code" value="net.abumarkub.midi.applet.MidiApplet" />';b+='<param name="scriptable" value="true" />';b+='<param name="minJavaVersion" value="1.5">';b+='Your browser needs the Java plugin to use the midibridge. You can download it <a href="http://www.java.com/en/" target="blank" title="abumarkub midibridge download java" rel="abumarkub midibridge download java">here</a>';b+="</object>";a.innerHTML=b;document.body.appendChild(a)}var a={NOTE_OFF:128,NOTE_ON:144,POLY_PRESSURE:160,CONTROL_CHANGE:176,PROGRAM_CHANGE:192,CHANNEL_PRESSURE:208,PITCH_BEND:224,SYSTEM_EXCLUSIVE:240};var b=JSON.parse;var c=null;var d=null;var e=null;var f=null;var g=false;var h=false;var i=true;var j="java";var k={};a.init=function(a){if(typeof a==="function"){c=a}else if(typeof a==="object"){var b=a;g=b.connectAllInputs;h=b.connectFirstOutput;i=b.connectAllInputsToFirstOutput;c=b.data;e=b.ready;d=b.error;switch(true){case g&&h:g=false;h=false;i=true;break;case i:g=false;h=false;break;case h:g=false;i=false;break;case g:h=false;i=false;break}}if(!navigator.javaEnabled()){if(d){d("no java plugin found; install or enable the java plugin")}else{console.log("no java plugin found; install or enable the java plugin")}return}try{JSON;l()}catch(f){if(d){d("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+")}else{console.log("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+")}}};a.msgFromJava=function(j){var l=b(j);var n=l.msgId;switch(n){case"upgrade-java":if(d){d("please upgrade your java plugin!")}else{console.log("please upgrade your java plugin!")}break;case"midi-started":p();k=l.devices;if(f){if(e){e("midibridge started")}if(g){a.connectAllInputs()}if(h){a.connectFirstOutput()}if(i){a.connectAllInputsToFirstOutput()}}break;case"midi-data":if(c){c(new m(l))}break;case"error":if(d){d(l.code)}break}};a.sendMidiEvent=function(a,c,d,e){return b(f.processMidiEvent(a,c,d,e))};a.getDevices=function(){return k};a.refreshDevices=function(){return b(f.getDevices())};a.connectAllInputs=function(){return b(f.connectAllInputs())};a.connectFirstOutput=function(){return b(f.connectFirstOutput())};a.connectAllInputsToFirstOutput=function(){return b(f.connectAllInputsToFirstOutput())};a.addConnection=function(a,c,d){c=c==undefined?-1:c;d=d==undefined?[]:d;return b(f.addConnection(a,c,d))};a.removeConnection=function(a,c){return b(f.removeConnection(a,c))};a.disconnectAll=function(){return b(f.disconnectAll())};var m=function(b){this.data1=b.data1;this.data2=b.data2;this.status=b.status;this.status=this.data2==0&&this.status==a.NOTE_ON?a.NOTE_OFF:this.status;this.channel=b.channel;this.noteName=n(this.data1);this.statusCode=o(this.status);this.toString=function(){var a="";a+=this.noteName+" "+this.statusCode+" "+this.data1+" "+this.data2+" "+this.status;return a}};var n=function(){var a=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];var b=["C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B"];return function(c,d){var e=Math.floor(c/12-1);var f=d=="sharp"?a[c%12]:b[c%12];return f+""+e}}();var o=function(){var b=[];b[128]="NOTE OFF";b[144]="NOTE ON";b[160]="POLY PRESSURE";b[176]="CONTROL CHANGE";b[192]="PROGRAM CHANGE";b[208]="CHANNEL PRESSURE";b[224]="PITCH BEND";b[240]="SYSTEM EXCLUSIVE";a.status=b;return function(a){return b[a]}}(a);if(!window.addEventListener){window.addEventListener=function(a,b,c){window.attachEvent("onload",b)}}window.midiBridge=a})(window)
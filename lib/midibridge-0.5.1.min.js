(function(){function f(){return!a.ready?(e&&e("midibridge not ready!"),"midibridge not ready!"):!0}function p(){try{c=a.getObject("midibridge-applet")}catch(b){setTimeout(p,25)}}var a={NOTE_OFF:128,NOTE_ON:144,POLY_PRESSURE:160,CONTROL_CHANGE:176,PROGRAM_CHANGE:192,CHANNEL_PRESSURE:208,PITCH_BEND:224,SYSTEM_EXCLUSIVE:240,NOTE_NAMES_SHARP:"sharp",NOTE_NAMES_FLAT:"flat",NOTE_NAMES_SOUNDFONT:"soundfont",NOTE_NAMES_ENHARMONIC_SHARP:"enh-sharp",NOTE_NAMES_ENHARMONIC_FLAT:"enh-flat"},g=[];g[128]="NOTE OFF";
g[144]="NOTE ON";g[160]="POLY PRESSURE";g[176]="CONTROL CHANGE";g[192]="PROGRAM CHANGE";g[208]="CHANNEL PRESSURE";g[224]="PITCH BEND";g[240]="SYSTEM EXCLUSIVE";var n={sharp:"C,C#,D,D#,E,F,F#,G,G#,A,A#,B".split(","),flat:"C,D\u266d,D,E\u266d,E,F,G\u266d,G,A\u266d,A,B\u266d,B".split(","),soundfont:"C,Db,D,Eb,E,F,Gb,G,Ab,A,Bb,B".split(","),"enh-sharp":"B#,C#,C##,D#,D##,E#,F#,F##,G#,G##,A#,A##".split(","),"enh-flat":"D\u266d\u266d,D\u266d,E\u266d\u266d,E\u266d,F\u266d,G\u266d\u266d,G\u266d,A\u266d\u266d,A\u266d,B\u266d,B\u266d,C\u266d".split(",")},
d=JSON.parse,m=null,e=null,o=null,c=null,h=!1,i=!1,j=!1,k=!0,q={};a.version="0.5.1";a.ready=!1;a.noteNameModus=a.NOTE_NAMES_SHARP;a.init=function(b){if("function"===typeof b)m=b;else if("object"===typeof b)switch(h=b.connectAllInputs,i=b.connectFirstInput,j=b.connectFirstOutput,k=b.connectAllInputsToFirstOutput,m=b.data,o=b.ready,e=b.error,!0){case h&&j:j=i=h=!1;k=!0;break;case k:j=i=i=h=!1;break;case i:k=h=!1;break;case j:k=h=!1;break;case h:k=j=i=!1}if(navigator.javaEnabled())try{JSON;var a=document.createElement("div");
a.setAttribute("id","midibridge-java");a.innerHTML='<applet id="midibridge-applet" code="net.abumarkub.midi.applet.MidiApplet.class" archive="midiapplet.jar" codebase="java" width="1" height="1"><param name="minJavaVersion" value="1.5"></applet>';document.body.appendChild(a)}catch(c){e?e("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+"):console.log("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+")}else e?
e("no java plugin found; install or enable the java plugin"):console.log("no java plugin found; install or enable the java plugin")};a.msgFromJava=function(b){b=d(b);switch(b.msgId){case "upgrade-java":e?e("please upgrade your java plugin!"):console.log("please upgrade your java plugin!");break;case "midi-started":p();c&&(q=b.devices,a.ready=!0,h&&a.connectAllInputs(),i&&a.connectFirstInput(),j&&a.connectFirstOutput(),k&&a.connectAllInputsToFirstOutput(),o&&o("midibridge started"));break;case "midi-data":m&&
m(new r(b));break;case "error":e&&e(b.code)}};a.sendMidiEvent=function(b,a,l,e){if(f())return d(c.processMidiEvent(b,a,l,e))};a.getDevices=function(){return q};a.refreshDevices=function(){if(f())return d(c.getDevices())};a.connectAllInputs=function(){if(f())return d(c.connectAllInputs())};a.connectFirstInput=function(){if(f())return d(c.connectFirstInput())};a.connectFirstOutput=function(){if(f())return d(c.connectFirstOutput())};a.connectAllInputsToFirstOutput=function(){if(f())return d(c.connectAllInputsToFirstOutput())};
a.addConnection=function(b,a,l){if(f())return l=void 0===l?[]:l,d(c.addConnection(b,void 0===a?-1:a,l))};a.removeConnection=function(b,a){if(f())return d(c.removeConnection(b,a))};a.disconnectAll=function(){if(f())return d(c.disconnectAll())};a.loadBase64String=function(b){return d(c.loadBase64String(b))};a.playBase64String=function(b){return d(c.playBase64String(b))};a.loadMidiFile=function(b){return d(c.loadMidiFile(b))};a.playMidiFile=function(b){return d(c.playMidiFile(b))};a.startSequencer=function(){c.startSequencer()};
a.pauseSequencer=function(){c.pauseSequencer()};a.stopSequencer=function(){c.stopSequencer()};a.closeSequencer=function(){c.closeSequencer()};a.getSequencerPosition=function(){return c.getSequencerPosition()};a.setSequencerPosition=function(b){c.setSequencerPosition(b)};var r=function(){var b=function(b){this.data1=b.data1;this.data2=b.data2;this.status=b.status;this.status=0===this.data2&&this.status==a.NOTE_ON?a.NOTE_OFF:this.status;this.channel=b.channel;this.noteName=a.getNoteName(this.data1,
a.noteNameModus);this.statusCode=a.getStatus(this.status);this.microsecond=b.microsecond;this.time=a.getNiceTime(this.microsecond)};b.prototype={toString:function(){var b;b=""+(this.noteName+" "+this.statusCode+" "+this.data1+" "+this.data2+" "+this.status);return b+=this.microsecond?this.microsecond+" "+this.time:""},toJSONString:function(){return this.microsecond?"{'notename':"+this.noteName+", 'status':"+this.status+", 'data1':"+this.data1+", 'data2':"+this.data2+", 'microsecond':"+this.microsecond+
", 'time':"+this.time+"}":"{'notename':"+this.noteName+", 'status':"+this.status+", 'data1':"+this.data1+", 'data2':"+this.data2+"}"}};return b}();a.MidiMessage=r;a.getNoteName=function(b,a){return n[a][b%12]+""+Math.floor(b/12-1)};a.getNoteNumber=function(b,a){var c=-1,b=b.toUpperCase(),d;for(d in n)for(var e=n[d],f=0,g=e.length;f<g;f++)if(e[f]===b){c=f;break}return-1===c?"invalid note name":noteNumber=12+c+12*a};a.getStatus=function(b){return g[b]};a.getNiceTime=function(b){var a=b/1E3/1E3>>0,c=
a/3600>>0,d=a%3600/60>>0,a=a%60,b=b/1E3-36E5*c-6E4*d-1E3*a+0.5>>0;return""+(0<c?c+":":"")+(0<c?10>d?"0"+d:d:d)+":"+(10>a?"0"+a:a)+":"+(0===b?"000":10>b?"00"+b:100>b?"0"+b:b)};a.getObject=function(a){var c=navigator.userAgent.toLowerCase();return-1!==c.indexOf("msie")||-1!==c.indexOf("webkit")?window[a]:document[a]};window.addEventListener||(window.addEventListener=function(a,c){window.attachEvent("onload",c)});window.midiBridge=a})(window);